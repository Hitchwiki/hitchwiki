---
# Ansible playbook for hitchwiki development environment
#   https://docs.ansible.com/ansible/latest/playbooks_intro.html
- hosts: hitchwiki

  vars:
# Vagrant starts ansible after bringing up the machine (ubuntu/xenial)
#   https://docs.ansible.com/ansible/latest/guide_vagrant.html
#   https://www.vagrantup.com/docs/provisioning/ansible.html
# The user for the est environment is ubuntu. See Vagrantfile
    remote_user: ubuntu

# Deployment is split into roles with tasks, handlers and templates:
#    https://docs.ansible.com/ansible/latest/playbooks_reuse.html
# 
# Following roles are based on the install_funcs.sh script by Pedro.
# Common is for system updates, db for mariadb, web for apache2, php and all modules, including composer, mw setups mediawiki and fills it.
- name: Common system configuration
  hosts: all
  roles:
    - common

- name: Deploy database server
  hosts: all
  roles:
    - db

- name: Setup webserver with PHP7 and node
  hosts: all
  roles:
    - web

- name: Install mediawiki, extensions and insert content
  hosts: all
  roles:
    - mw

# For development some services like mail-catcher and phpmyadmin are necessary.
- name: Development
  hosts: dev
  roles:
    - dev

# Production specific configuration
#- name: Production
#  hosts: production
#  roles:
#    - production
