---

# Status report
- name: Create facts.d (http://jpmens.net/2015/01/29/caching-facts-in-ansible/)
  become: yes
  file: state=directory path=/etc/ansible/facts.d/
- name: Run status.sh
  become: yes
  shell: "{{ dir.script }}/status.sh"
- name: Set statefile
  set_fact:
    statefile: /etc/ansible/facts.d/state.yml
- name: Grant {{ statefile }} to user {{ user }}
  become: yes
  file: path={{ statefile }} owner={{ user }} group={{ user }}
- name: Load statefile
  include_vars: "{{ statefile }}"

- shell: |
    echo "
    #######################################################################
    #                                                                     #
    #                     - Hitchwiki is installed -                      #
    #                                                                     #
    #                                                                     #
    # - Suspend the virtual machine by calling 'vagrant suspend'.         #
    # - When you're ready to begin working again, just run 'vagrant up'.  #
    # - To re-install, run 'vagrant destroy && vagrant up'.               #
    # - Read more at http://github.com/Hitchwiki/hitchwiki                #
    #                                                                     #
    #                 Have fun and happy hacking!                         #
    #                                                                     #
    #######################################################################
    Tip: Run 'rgrep TODO roles' to see open tasks."
  when: configured.system and configured.web and configured.db and configured.mw and configured.parsoid
  register: outro
- debug:
    var: outro.stdout_lines
  when: not outro|skipped

- debug:
    var: configured
- debug:
    var: started

...
