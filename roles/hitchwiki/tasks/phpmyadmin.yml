---

- name: Configure PHPMyAdmin
  become: true
  # TODO maybe use https://docs.ansible.com/ansible/latest/dpkg_selections_module.html
  # TODO Is it necessary to run this before the installation of the phpmyadmin package?
  shell: |
    debconf-set-selections <<< "phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2"
    debconf-set-selections <<< "phpmyadmin phpmyadmin/dbconfig-install boolean true"
    debconf-set-selections <<< "phpmyadmin phpmyadmin/mysql/admin-user string {{db.username}}"
    debconf-set-selections <<< "phpmyadmin phpmyadmin/mysql/admin-pass password {{db.password}}"
    debconf-set-selections <<< "phpmyadmin phpmyadmin/mysql/app-pass password {{db.phpmyadmin_password}}"
    debconf-set-selections <<< "phpmyadmin phpmyadmin/app-password-confirm password {{db.phpmyadmin_password}}"

- name: Add PHPMyAdmin configuration to Apache
  become: true
  lineinfile:
    path: /etc/phpmyadmin/apache.conf
    regexp: '(Alias /).*(/usr/share/phpmyadmin)'
    line: '\1{{ dir.phpmyadmin }} \2'
  notify:
  - apache

- name: Successfully set up PHPMyAdmin
  lineinfile:
    path: "{{ dir.state }}"
    regexp: '^  phpmyadmin:'
    line: "  phpmyadmin: True"
  notify:
  - load

...
